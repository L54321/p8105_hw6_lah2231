p8105_hw6_lah2231
================
Laura Henze
2024-12-02

# Problem 2

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
homicide_data <- read.csv("data/homicide-data.csv")
#View(homicide_data)
```

``` r
head(homicide_data)
```

    ##          uid reported_date victim_last victim_first victim_race victim_age
    ## 1 Alb-000001      20100504      GARCIA         JUAN    Hispanic         78
    ## 2 Alb-000002      20100216     MONTOYA      CAMERON    Hispanic         17
    ## 3 Alb-000003      20100601 SATTERFIELD      VIVIANA       White         15
    ## 4 Alb-000004      20100101    MENDIOLA       CARLOS    Hispanic         32
    ## 5 Alb-000005      20100102        MULA       VIVIAN       White         72
    ## 6 Alb-000006      20100126        BOOK    GERALDINE       White         91
    ##   victim_sex        city state      lat       lon           disposition
    ## 1       Male Albuquerque    NM 35.09579 -106.5386 Closed without arrest
    ## 2       Male Albuquerque    NM 35.05681 -106.7153      Closed by arrest
    ## 3     Female Albuquerque    NM 35.08609 -106.6956 Closed without arrest
    ## 4       Male Albuquerque    NM 35.07849 -106.5561      Closed by arrest
    ## 5     Female Albuquerque    NM 35.13036 -106.5810 Closed without arrest
    ## 6     Female Albuquerque    NM 35.15111 -106.5378        Open/No arrest

## Preparing Data

``` r
prepared_homicide_data <- 
  homicide_data |>
  mutate(
    city_state = paste(city, state, sep = ", "),
    resolved = as.numeric(disposition == "Closed by arrest"),
    victim_age = as.numeric(victim_age)
  ) |>
  filter(
    !city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL"),
    victim_race %in% c("White", "Black"),
    !is.na(victim_age)
  )
```

    ## Warning: There was 1 warning in `mutate()`.
    ## ℹ In argument: `victim_age = as.numeric(victim_age)`.
    ## Caused by warning:
    ## ! NAs introduced by coercion

``` r
#View(prepared_homicide_data)
```

I created city_state and resolved, converted victim_age to numeric,
omitted specific cities, and limited to White/Black races. I excluded
the lines without known ages.

## Logistic Regression for Baltimore

``` r
baltimore_data <- 
  prepared_homicide_data |> 
  filter(city_state == "Baltimore, MD")

baltimore_model <- 
  glm(
    resolved ~ victim_age + victim_sex + victim_race, 
    data = baltimore_data, 
    family = binomial()
  )

baltimore_results <- 
  broom::tidy(baltimore_model)

baltimore_sex_or <- 
  baltimore_results |> 
  filter(term == "victim_sexMale") |> 
  mutate(
    OR = exp(estimate), 
    CI_lower = exp(estimate - 1.96 * std.error), 
    CI_upper = exp(estimate + 1.96 * std.error)
  ) |> 
  select(term, OR, CI_lower, CI_upper)

baltimore_sex_or
```

    ## # A tibble: 1 × 4
    ##   term              OR CI_lower CI_upper
    ##   <chr>          <dbl>    <dbl>    <dbl>
    ## 1 victim_sexMale 0.426    0.325    0.558

For the Baltimore regression analysis I filtered for Baltimore, fit the
logistic regression using glm with resolved as the outcome and I
extracted odds ratio and confidence interval to cpmare male and female
victims. The results indicate that male victims are less likely to have
their homicides resolved compared to female victims with an odds ratio
of 0.4255 (95% CI: 0.3246–0.5579).

## Logistic Regression for each city

``` r
city_model_results <- 
  prepared_homicide_data |> 
  nest(data = -city_state) |> 
  mutate(
    model = map(data, \(df) glm(resolved ~ victim_age + victim_sex + victim_race, data = df, family = binomial())),
    results = map(model, broom::tidy)
  ) |> 
  select(city_state, results) |> 
  unnest(results) |> 
  filter(term == "victim_sexMale") |> 
  mutate(
    OR = exp(estimate),
    CI_lower = exp(estimate - 1.96 * std.error),
    CI_upper = exp(estimate + 1.96 * std.error)
  )

city_model_results
```

    ## # A tibble: 47 × 9
    ##    city_state      term     estimate std.error statistic  p.value    OR CI_lower
    ##    <chr>           <chr>       <dbl>     <dbl>     <dbl>    <dbl> <dbl>    <dbl>
    ##  1 Albuquerque, NM victim_…  5.70e-1     0.385  1.48     1.39e- 1 1.77     0.831
    ##  2 Atlanta, GA     victim_…  7.71e-5     0.194  0.000397 1.00e+ 0 1.00     0.684
    ##  3 Baltimore, MD   victim_… -8.54e-1     0.138 -6.18     6.26e-10 0.426    0.325
    ##  4 Baton Rouge, LA victim_… -9.64e-1     0.306 -3.15     1.65e- 3 0.381    0.209
    ##  5 Birmingham, AL  victim_… -1.39e-1     0.212 -0.657    5.11e- 1 0.870    0.574
    ##  6 Boston, MA      victim_… -3.95e-1     0.326 -1.21     2.26e- 1 0.674    0.356
    ##  7 Buffalo, NY     victim_… -6.53e-1     0.299 -2.18     2.90e- 2 0.521    0.290
    ##  8 Charlotte, NC   victim_… -1.23e-1     0.236 -0.524    6.00e- 1 0.884    0.557
    ##  9 Chicago, IL     victim_… -8.91e-1     0.102 -8.77     1.86e-18 0.410    0.336
    ## 10 Cincinnati, OH  victim_… -9.17e-1     0.269 -3.41     6.49e- 4 0.400    0.236
    ## # ℹ 37 more rows
    ## # ℹ 1 more variable: CI_upper <dbl>

``` r
#View(city_model_results)
```

I made the logistic regression for each city by grouping data by city,
fitting the logistic regression for each city and extracting odds ratio
and confidence interval for victim_sexMale.

## Plotting Odds Ratio and Confidence Interval for each city comparing male and female victims

``` r
city_model_results |> 
  ggplot(aes(x = reorder(city_state, OR), y = OR)) +
  geom_point() +
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper), width = 0.2) +
  coord_flip() +
  labs(
    title = "Odds ratios for resolved homicides. by city",
    x = "City",
    y = "Odds ratio male vs. female)"
  )
```

![](p8105_hw6_lah2231_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

I plotted the adjusted odds ratio and confidence intervals for resolved
homicides in each city, comparing male and female victims. The
likelihood to resolve cases with male victims varies across cities, in
cities that have an OR of less than 1 male victims are less likely to
have their homicides resolved in comparison to female victims. The error
bars in the plot represent the uncertainty, the wider the more
uncertainty. The result and the plot indicate that male victims are less
likely to be resolved because most cities show odds ratios \< 1.
Albuquerque with the highest rate of resolved crimes for men with odds
ratio 1.77 (CI: 0.83–3.76) has a wide uncertainty, making this result
much less reliable.

# Problem 3
