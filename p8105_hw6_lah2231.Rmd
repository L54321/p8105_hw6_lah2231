---
title: "p8105_hw6_lah2231"
author: "Laura Henze"
date: "2024-12-02"
output: github_document
---

# Problem 2
```{r}
library(tidyverse)
```

```{r}
homicide_data <- read.csv("data/homicide-data.csv")
#View(homicide_data)
```

```{r}
head(homicide_data)
```

## Preparing Data
```{r}
prepared_homicide_data <- 
  homicide_data |>
  mutate(
    city_state = paste(city, state, sep = ", "),
    resolved = as.numeric(disposition == "Closed by arrest"),
    victim_age = as.numeric(victim_age)
  ) |>
  filter(
    !city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL"),
    victim_race %in% c("White", "Black"),
    !is.na(victim_age)
  )
#View(prepared_homicide_data)
```

I created city_state and resolved, converted victim_age to numeric, omitted specific cities, and limited to White/Black races. I excluded the lines without known ages.

## Logistic Regression for Baltimore
```{r}
baltimore_data <- 
  prepared_homicide_data |> 
  filter(city_state == "Baltimore, MD")

baltimore_model <- 
  glm(
    resolved ~ victim_age + victim_sex + victim_race, 
    data = baltimore_data, 
    family = binomial()
  )

baltimore_results <- 
  broom::tidy(baltimore_model)

baltimore_sex_or <- 
  baltimore_results |> 
  filter(term == "victim_sexMale") |> 
  mutate(
    OR = exp(estimate), 
    CI_lower = exp(estimate - 1.96 * std.error), 
    CI_upper = exp(estimate + 1.96 * std.error)
  ) |> 
  select(term, OR, CI_lower, CI_upper)

baltimore_sex_or
```

For the Baltimore regression analysis I filtered for Baltimore, fit the logistic regression using glm with resolved as the outcome and I extracted odds ratio and confidence interval to cpmare male and female victims. The results indicate that male victims are less likely to have their homicides resolved compared to female victims with an odds ratio of 0.4255 (95% CI: 0.3246–0.5579).

## Logistic Regression for each city 
```{r}
city_model_results <- 
  prepared_homicide_data |> 
  nest(data = -city_state) |> 
  mutate(
    model = map(data, \(df) glm(resolved ~ victim_age + victim_sex + victim_race, data = df, family = binomial())),
    results = map(model, broom::tidy)
  ) |> 
  select(city_state, results) |> 
  unnest(results) |> 
  filter(term == "victim_sexMale") |> 
  mutate(
    OR = exp(estimate),
    CI_lower = exp(estimate - 1.96 * std.error),
    CI_upper = exp(estimate + 1.96 * std.error)
  )

city_model_results
#View(city_model_results)
```
I made the logistic regression for each city by grouping data by city, fitting the logistic regression for each city and extracting odds ratio and confidence interval for victim_sexMale.

## Plotting Odds Ratio and Confidence Interval for each city comparing male and female victims
```{r}
city_model_results |> 
  ggplot(aes(x = reorder(city_state, OR), y = OR)) +
  geom_point() +
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper), width = 0.2) +
  coord_flip() +
  labs(
    title = "Odds ratios for resolved homicides. by city",
    x = "City",
    y = "Odds ratio male vs. female)"
  )
```

I plotted the adjusted odds ratio and confidence intervals for resolved homicides in each city, comparing male and female victims. The likelihood to resolve cases with male victims varies across cities, in cities that have an OR of less than 1 male victims are less likely to have their homicides resolved in comparison to female victims. The error bars in the plot represent the uncertainty, the wider the more uncertainty.
The result and the plot indicate that male victims are less likely to be resolved because most cities show odds ratios < 1. Albuquerque with the highest rate of resolved crimes for men with odds ratio 1.77 (CI: 0.83–3.76) has a wide uncertainty,  making this result much less reliable.

# Problem 3
```{r}
birthweight_data <- read.csv("data/birthweight.csv")
#View(birthweight_data)
```

## Converting numeric variables to labels where appropriate
```{r}
birthweight_data <- birthweight_data |>
  mutate(
    babysex = factor(babysex, levels = c(1, 2), labels = c("Male", "Female")),
    frace = factor(frace, levels = c(1, 2, 3, 4, 8, 9), labels = c("White", "Black", "Asian", "Puerto Rican", "Other", "Unknown")),
    mrace = factor(mrace, levels = c(1, 2, 3, 4, 8), labels = c("White", "Black", "Asian", "Puerto Rican", "Other")),
    malform = factor(malform, levels = c(0, 1), labels = c("Absent", "Present"))
  )
```

## Checking for missing values
```{r}
missing_values <- colSums(is.na(birthweight_data))
missing_values
```
## Summarizing dataset
```{r}
summary(birthweight_data)
```






































